(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{508:function(t,a,e){"use strict";e.r(a);var s=e(48),r=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"mongodb-の定期バックアップ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-の定期バックアップ","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB の定期バックアップ")]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#前提条件"}},[t._v("前提条件")])]),e("li",[e("a",{attrs:{href:"#バックアップ用コンテナによる管理"}},[t._v("バックアップ用コンテナによる管理")])]),e("li",[e("a",{attrs:{href:"#docker-compose-による管理"}},[t._v("docker-compose による管理")])]),e("li",[e("a",{attrs:{href:"#google-cloud-platform-による管理"}},[t._v("Google Cloud Platform による管理")])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"前提条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前提条件","aria-hidden":"true"}},[t._v("#")]),t._v(" 前提条件")]),t._v(" "),e("ul",[e("li",[t._v("バックアップ/リストアは、"),e("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[t._v("weseek/mongodb-awesome-backup"),e("OutboundLink")],1),t._v(" を利用します")])]),t._v(" "),e("h4",{attrs:{id:"必要なもの"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#必要なもの","aria-hidden":"true"}},[t._v("#")]),t._v(" 必要なもの")]),t._v(" "),e("ul",[e("li",[t._v("docker")]),t._v(" "),e("li",[t._v("バックアップファイルをアップロードするための AWS S3 バケット\n"),e("ul",[e("li",[t._v("S3 バケットへのアクセス権を持った IAM ユーザーのアクセスキーおよびシークレットキー")])])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("事前に "),e("RouterLink",{attrs:{to:"/ja/admin-guide/admin-cookbook/mongodb-backup.html"}},[t._v("MongoDB のバックアップ/リストア")]),t._v(" ページを確認することをお勧めします")],1)]),t._v(" "),e("h2",{attrs:{id:"バックアップ用コンテナによる管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#バックアップ用コンテナによる管理","aria-hidden":"true"}},[t._v("#")]),t._v(" バックアップ用コンテナによる管理")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("CRONMODE を true に設定したコンテナを起動します")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("docker run --rm \\\n  -e MONGODB_HOST"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Target MongoDB Host"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\\n  -e AWS_ACCESS_KEY_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Your IAM Access Key ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\\n  -e AWS_SECRET_ACCESS_KEY"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Your IAM Secret Access Key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\\n  -e S3_TARGET_BUCKET_URL"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Target S3 Bucket URL "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s3://"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\\n  -e CRONMODE"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true \\\n  -e "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CRON_EXPRESSION=0 4 * * *"')]),t._v(" \\\n  weseek/mongodb-awesome-backup\n")])])])]),t._v(" "),e("li",[e("p",[t._v("対象となる MongoDB サーバーの全てのデータベースを、毎日 AM 4:00 にバックアップするコンテナが起動します")])])]),t._v(" "),e("h4",{attrs:{id:"バックアップの世代管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#バックアップの世代管理","aria-hidden":"true"}},[t._v("#")]),t._v(" バックアップの世代管理")]),t._v(" "),e("ul",[e("li",[t._v("(執筆者・PR募集)")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("その他のオプションは "),e("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[t._v("weseek/mongodb-awesome-backup"),e("OutboundLink")],1),t._v(" を参照してください")])]),t._v(" "),e("h2",{attrs:{id:"docker-compose-による管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-による管理","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose による管理")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("GROWI を "),e("RouterLink",{attrs:{to:"/ja/admin-guide/getting-started/docker-compose.html"}},[t._v("growi-docker-compose")]),t._v(" で管理している場合、更に簡単にバックアップ用コンテナを起動できます")],1)]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/weseek/growi-docker-compose/tree/master/examples/backup-mongodb-data",target:"_blank",rel:"noopener noreferrer"}},[t._v("weseek/growi-docker-compose"),e("OutboundLink")],1),t._v(" の "),e("a",{attrs:{href:"https://github.com/weseek/growi-docker-compose/tree/master/examples/backup-mongodb-data",target:"_blank",rel:"noopener noreferrer"}},[t._v("Example"),e("OutboundLink")],1),t._v(" を参考に、以下の手順を行います")])]),t._v(" "),e("ol",[e("li",[e("p",[t._v("clone")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/weseek/growi-docker-compose.git growi\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" growi\n")])])])]),t._v(" "),e("li",[e("p",[e("code",[t._v("docker-compose.override.yml")]),t._v(" をルートディレクトリにコピー")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -p examples/backup-mongodb-data/docker-compose.override.yml "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n")])])])])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[e("p",[e("code",[t._v("docker-compose.override.yml")]),t._v(" を編集し、"),e("code",[t._v("CRON_EXPRESSION")]),t._v(", "),e("code",[t._v("AWS_ACCESS_KEY_ID")]),t._v(", "),e("code",[t._v("AWS_SECRET_ACCESS_KEY")]),t._v(", "),e("code",[t._v("S3_TARGET_BUCKET_URL")]),t._v("へ環境に合わせた値を入力します\n")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("(略)\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CRONMODE=true\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CRON_EXPRESSION=0 4 * * *\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AWS_ACCESS_KEY_ID=$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Your IAM Access Key ID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AWS_SECRET_ACCESS_KEY=$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Your IAM Secret Access Key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" S3_TARGET_BUCKET_URL=s3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Your Bucket Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n(略)\n")])])])]),t._v(" "),e("li",[e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("docker-compose up\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"google-cloud-platform-による管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#google-cloud-platform-による管理","aria-hidden":"true"}},[t._v("#")]),t._v(" Google Cloud Platform による管理")]),t._v(" "),e("ul",[e("li",[t._v("(執筆者・PR募集)")])])])},[],!1,null,null,null);a.default=r.exports}}]);